<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script>
<script type="module" src="/sofi/js/script.js"></script>
<link rel="stylesheet" href="/sofi/css/estil.css">


<header>
    <h1>WebApps</h1>

    <abstract>
        <p>
            En aquesta pràctica ens iniciarem amb les tecnologies que s'utilitzen per al desenvolupament
            d'aplicacions web.
        </p>
        <p>
            Necessitaràs <a href="/setupwebserver/">tenir preparat un contenidor</a>.
        </p>
    </abstract>
</header>

<section>
    <h2>World Wide Web</h2>
    <p>El científic anglés <a href="https://ca.wikipedia.org/wiki/Tim_Berners-Lee">Tim Berners-Lee</a> 
        va inventar la World Wide Web (WWW), Xarxa d'Abast Mundial, en 1989, mentre treballava al CERN.
    </p>
    <p>Coneguda comunament com la Web, és un sistema
        d'informació on documents i altres recursos són identificats amb URLs (Uniform Resource Locators),
        com, per exemple, <url>http://wikipedia.org</url>, que poden ser enllaçats amb 
        <a href="https://ca.wikipedia.org/wiki/Hipertext">hypertext</a>, i són accessibles a través 
        d'Internet.
        <br>Els recrsos de la Web són transferits pels Servidors Web via l'
        <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">Hypertext Transfer Protocol</a> 
        (HTTP) i es pot accedir a ells utilitzant el Navegador Web.
    </p>

    <h3>URLs</h3>

    <p>Com hem dit, les URLs són identificadors de recursos. Els recursos poden ser molt diversos: pàgines,
        imatges, videos, fitxers, etcètera. Per exemple:</p>
    
    <ul>
        <li><p>La url <url>http://info.cern.ch/</url> identifica la pàgina principal del CERN</p></li>
        <li><p>La url <url>https://upload.wikimedia.org/wikipedia/commons/f/f8/Tim_Berners-Lee.jpg</url>
        identifica una imatge (de Tim, és clar)</p></li>
        <li>La url <url>https://upload.wikimedia.org/wikipedia/commons/a/a3/Tim_Berners_Lee_changed_the_world_25_years_ago_-_Tim_Berners_Lee.webm</url>
            identifica un vídeo.<p></p></li>
    </ul>

    <p>Una URL es compon de 7 components:</p>

    <img src="img/url_syntax.png">

    <ul>
        <li><name>Scheme</name>: defineix el protocol d'accés al document 
            (<tech>http</tech>, <tech>https</tech>, <tech>ftp</tech>, <tech>mailto</tech>, <tech>file</tech>, <tech>data</tech>)</li>
        <li><name>User</name>: la identifiació de l'usuari que accedeix al recurs</li>
        <li><name>Host</name>: l'adreça IP o el nom DNS del servidor</li>
        <li><name>Port</name>: El port del servidor al qual es connecta</li>
        <li><name>Path</name>: Identifica el recurs al qual es vol accedir</li>
        <li><name>Query</name>: Dades addicionals sobre el recurs</li>
        <li><name>Fragment</name>: Localització a dintre del propi recurs</li>
    </ul>

    Anem a veure amb més detall aquests components.

    <h4>Scheme</h4>
    <p>El protocol d'accés al recurs indica la forma concreta en que s'han de
        comunicar el que fa la petició i el que la respón.</p>
    
    <p>Per exemple, el protocol <tech>http</tech> serveix per a comunicar
        amb un servidor web. La especificacio del protocol és molt extensa, però podem veure un
        exemple senzill.</p>
    <p>En la seva forma més utilitzada, HTTP serveix per a obtenir recursos.</p>
    <p>Suposem que volem obtenir la pàgina principal del CERN. Aleshores, hem de realitzar
        un petició HTTP al seu servidor (<tech>info.cern.ch</tech>). Les dades que enviarem al servidor han de seguir
        exactament el protocol.
    </p>

    <p>Utilitzarem el programa <inshell>nc</inshell> per a comunicar amb el servidor del CERN.</p>

    <p>Obre un terminal i executa la següent comanda:</p>

    <terminal>
        <host>@host</host>
        <shell>
            nc info.cern.ch 80
        </shell>
    </terminal>

    <p>Amb aquesta comanda hem connectat al port <tech>80</tech> del servidor del CERN.
        <br>Ara el servidor està esperant que li enviem dades.</p>
    <p>Si enviem qualsevol dada al servidor, aquest no serà capaç de comprendre la petició.
        Li hem de enviar les dades adequades, seguint el protocol HTTP.
    </p>
    <p>Prova a escriure alguna cosa, i polsa <kbd>Intro</kbd> per a enviar les dades al servidor.</p>
    <p>El servidor respondrà amb un error <tech>400 (Bad request)</tech>. La petició no ha estat correcta.</p>

    <img src="img/bad_request.png">

    <p>Per a fer la petició correcta hem fer el següent:</p>
    <ol>
        <li>
            <p>Connectem amb el servidor:</p>
            <shell>
                nc info.cern.ch 80
            </shell>    
        </li>
        <li>
            <p>Escrivim la comanda <inshell>GET</inshell>, 
                <br>després el recurs que volem <inshell>/index.html</inshell>
                <br>després la versió del protocol <inshell>HTTP/1.0</inshell>
                <br>després un "retorn de carro" <kbd>Ctrl + V</kbd> <kbd>Ctrl + M</kbd>
                <br>i per últim un "retorn de línia" <kbd>Intro</kbd>
            </p>
            <shell>            
                GET /index.html HTTP/1.0 <kbd>Ctrl + V</kbd> <kbd>Ctrl + M</kbd> <kbd>Intro</kbd>
            </shell>    
        </li>
        <li>
            <p>Especifiquem el Host al qual estem connectant
                <br>introduint <inshell>Host: info.cern.ch</inshell>
                <br>"retorn de carro" <kbd>Ctrl + V</kbd> <kbd>Ctrl + M</kbd>
                <br>i "retorn de línia" <kbd>Intro</kbd>
            </p>
            <shell>
                Host: info.cern.ch <kbd>Ctrl + V</kbd> <kbd>Ctrl + M</kbd> <kbd>Intro</kbd>
            </shell>
        </li>
        <li>
            <p>Indiquem al servidor que ha finalitzat la petició amb
                <br>"retorn de carro" <kbd>Ctrl + V</kbd> <kbd>Ctrl + M</kbd>
                <br>i "retorn de línia" <kbd>Intro</kbd>
            </p>
            <shell>
                <kbd>Ctrl + V</kbd> <kbd>Ctrl + M</kbd> <kbd>Intro</kbd>
            </shell>
        </li>
    </terminal>

    <p>Aquest cop sí, el servidor ens respon amb <incode>200 (OK)</incode>, i 
    ens retorna el recurs solicitat.</p>

    <img src="img/ok_request.png">

    <info>
        Aquesta petició que hem realitzat a mà és exactament el que fa el navegador web
        quan introduim la URL <url>http://info.cern.ch</url> a la barra d'adreçes.

        <p>Pots comprovar-ho de la següent forma:
            <ol>
                <li><p>Obre una pestanya nova del Firefox</p></li>
                <li><p>Polsa <kbd>F12</kbd> per a obrir les 
                    <strong>Eines de desenvolupador</strong></p></li>
                <li><p>Ves a la pestanya <img src="img/red.png"></p></li>
                <li><p>Introdueix <url>http://info.cern.ch/index.html</url> 
                    a la barra d'adreçes i navega a la pàgina</p></li>
                <li><p>Firefox et mostrarà tots els recursos que està 
                    descarregant del servidor</p></li>
                <li><p>Selecciona el recurs <tech>index.html</tech></p></li>
                <li><p>A la pestanya lateral <img src="img/cabeceras.png">, baixa
                fins a <img src="img/cabeceras_peticion.png"> i activa l'opció
                    <img src="img/sin_procesar.png"></p>
                </li>
            </ol>
        </p>
        <p>Ahí pots veure tota la petició HTTP que s'ha realitzat:</p>
        <img src="img/firefox_request.png">
    </info>

    <p>Ho farem ara al servidor que tenim instal·lat al nostre contenidor.</p>

    <h4>User</h4>
    <p>Alguns servidors requereixen d'autenticació amb usuari:contrasenya per a accedir 
        a certs recursos</p>
    </p>

    <p>Configurarem el nostre servidor per a requerir usuari:contrasenya en l'accés.</p>

    <p>Obrim el fitxer de configuració del servidor Apache:</p>

    <terminal>
        <host>@container</host>
        <shell>nano /etc/apache2/sites-enabled/000-default</shell>
    </terminal>

    <p>Afegim les següents línies per a activar l'accés amb usuari/password:</p>

    <codefile>
        /etc/apache2/sites-enabled/000-default
    </codefile>
    <code none data-line="8,9,10">
        &lt;VirtualHost *:80&gt;
            ServerAdmin webmaster@localhost
            DocumentRoot /var/www/html
            
            ErrorLog ${APACHE_LOG_DIR}/error.log
            CustomLog ${APACHE_LOG_DIR}/access.log combined

            &lt;Directory /var/www/html&gt;
                AllowOverride all
            &lt;/Directory&gt;
        &lt;/VirtualHost&gt;
    </code>

    <p>Creem l'usuari <w>Juan</w>:</p>
    <terminal>
        <host>@container</host>
        <shell>
            htpasswd -c /var/www/contrasenyes joan
        </shell>
    </terminal>


    <p>Comprovem que s'ha creat l'usuari:</p>
    <terminal>
        <host>@container</host>
        <shell>
            cat /var/www/contrasenyes
        </shell>
    </terminal>


    <p>Restringirem l'accés a la carepta <w>/var/www/html</w> a només aquells usuaris 
    que estiguin en l'arxiu <w>/var/www/contrasenyes</w>:</p>
    <terminal>
        <host>@container</host>
        <shell>nano /var/www/html/.htaccess</shell>
    </terminal>

    <p>El contingut de l'arxiu <file>.htaccess</file> ha de ser aquest:</p>
    <codefile>
        /var/www/html/.htaccess
    </codefile>
    <code none>
        AuthType Basic
        AuthName "Introdueix el teu usuari i contrasenya"
        AuthBasicProvider file
        AuthUserFile "/var/www/contrasenyes"
        Require valid-user
    </code>

    <p>Per últim reiniciem el servidor Apache:</p>

    <terminal>
        <host>@container</host>
        <shell>/etc/init.d/apache2 restart</shell>
    </terminal>

    <h4>Host</h4>
    <p>El host és l'adreça IP o nom DNS del servidor.</p>

    <p>Configurem el servidor web:</p>
    <terminal>
        <host>@container</host>
        <shell>
            mkdir /var/www/html/aaa.com
            mkdir /var/www/html/bbb.com
            echo "&lt;h1&gt;welcome to aaa.com&lt;/h1&gt;" >> /var/www/html/aaa.com/index.html
            echo "&lt;h1&gt;welcome to bbb.com&lt;/h1&gt;" >> /var/www/html/bbb.com/index.html
        </shell>
    </terminal>

    <codefile>
        /etc/apache2/sites-enabled/000-default
    </codefile>
    <code none>
        &lt;VirtualHost *:80&gt;
            ServerName aaa.com
            DocumentRoot /var/www/html/aaa.com
        &lt;/VirtualHost&gt;

        &lt;VirtualHost *:80&gt;
            ServerName bbb.com
            DocumentRoot /var/www/html/bbb.com
        &lt;/VirtualHost&gt;
    </code>


    <p>Realitzem dues peticions als diferents noms:</p>
    <terminal>
        <host>@host</host>
        <shell>
            printf 'GET /index.html HTTP/1.0\r\nHost aaa.com\r\n\r\n' | nc <replace>{IP_CONTENIDOR}</replace> 80
            printf 'GET /index.html HTTP/1.0\r\nHost bbb.com\r\n\r\n' | nc <replace>{IP_CONTENIDOR}</replace> 80
        </shell>
    </terminal>



    <h4>Port</h4>

    <p>Configurem Apache per a permetre conexions al port <w>8080</w>:</p>
    <terminal>
        <host>@host</host>
        <shell>
            nano /etc/apache2/ports.conf
        </shell>
    </terminal>
    
    <codefile>
        /etc/apache2/ports.conf
    </codefile>
    <code none data-line="2">
        Listen 80
        Listen 8080


        # resta de lines
        # ...
    </code>

    <p>Servim dues pàgines diferents en funcio del port de conexió:</p>
    <codefile>
        /etc/apache2/sites-enabled/000-default
    </codefile>
    <code none>
        &lt;VirtualHost *:80&gt;
            DocumentRoot /var/www/html/aaa.com
        &lt;/VirtualHost&gt;

        &lt;VirtualHost *:8080&gt;
            DocumentRoot /var/www/html/bbb.com
        &lt;/VirtualHost&gt;
    </code>

    <p>Accedim a <url>http://<replace>ip_contenidor</replace>:80</url></p>
    <p>Accedim a <url>http://<replace>ip_contenidor</replace>:8080</url></p>

    <h4>Path</h4>

    <h4>Query</h4>

    <h4>Fragment</h4>
</section>

<section>
    <h2>El navegador web</h2>


</section>
