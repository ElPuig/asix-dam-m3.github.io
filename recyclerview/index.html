
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>RecyclerView</title>
  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../elements/codelab.html">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <style is="custom-style">
    body {
      font-family: "Roboto",sans-serif;
      background: var(--google-codelab-background, #F8F9FA);
    }
  </style>
  
</head>
<body unresolved class="fullbleed">

  <google-codelab title="RecyclerView"
                  environment="web"
                  feedback-link="https://github.com/gerardfp">
    
      <google-codelab-step label="Introducció" duration="0">
        <p>El objetivo de esta práctica es explicar el elemento <strong>RecyclerView</strong>.</p>
<p>El widget <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.html" target="_blank"><code>RecyclerView</code></a> es una versión más flexible y avanzada de <a href="https://developer.android.com/reference/android/widget/ListView.html" target="_blank"><code>ListView</code></a>. Este widget es un contenedor para mostrar grandes conjuntos de datos que se pueden desplazar de manera muy eficiente al mantener una cantidad limitada de vistas. Usa el widget <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.html" target="_blank"><code>RecyclerView</code></a> cuando tengas conjuntos de datos cuyos elementos cambien en tiempo de ejecución sobre la base de la acción del usuario o los eventos de la red.</p>
<p>Realizaremos una aplicación que mostrará una lista con textos aleatorios</p>
<p><img style="max-width: 444.70px" src="img\3b90a07af599c7c5.png"></p>
<p><strong>RecyclerView</strong>: Es el encargado de mostrar la lista en pantalla</p>
<p><strong>Adapter</strong>: Es el encargado de crear el <em>layout</em> para cada ítem, y los datos con los que se rellena</p>
<p><strong>Dataset</strong>: Es el conjunto de datos</p>


      </google-codelab-step>
    
      <google-codelab-step label="Crea el projecte" duration="0">
        <p>Selecciona &#34;Empty Activity&#34; como plantilla para la actividad principal.</p>
<p>Añade las bibliotecas RecyclerView y CardView en el archivo build.gradle (Module: app)</p>
<pre><code>dependencies {
   . . . .
   implementation &#39;com.android.support:cardview-v7:26.1.0&#39;
   implementation &#39;com.android.support:recyclerview-v7:26.1.0&#39;
}</code></pre>
<aside class="special"><p>Obtén los números de versión más actualizados de: <a href="https://developer.android.com/topic/libraries/architecture/adding-components.html" target="_blank">Adding Components to Your Project</a></p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Dataset" duration="0">
        <p>Como Dataset utilizaremos un ArrayList, que contendrá las películas (autor y título).</p>
<p>Por el momento, rellenaremos el array con datos falsos, solamente para probar el RecyclerView. </p>
<p>Crea la clase <strong><code>Poem</code></strong> y añade los campos siguientes:</p>
<pre><code>public class Poem {
   public String title;
   public String author;
}</code></pre>
<p>En la MainActivity, añade el ArrayList como campo de la clase:</p>
<pre><code>public class MainActivity extends AppCompatActivity {
   List&lt;Poem&gt; poemList = new ArrayList&lt;&gt;();
   . . . .
}</code></pre>
<p>En el método onCreate() de la MainActivity, rellena el array con <em>fake data</em>:</p>
<pre><code>@Override
protected void onCreate(Bundle savedInstanceState) {
   . . . .

   for(int i = 0; i&lt;200; i++){
       Poem poem = new Poem();
       poem.author = &#34;Author &#34; + i;
       poem.title = &#34;Title &#34; + i;
       poemList.add(poem);
   }
}</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="RecyclerView" duration="0">
        <p><a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.html" target="_blank">RecyclerView</a> proporciona estos administradores de layout incorporados:</p>
<table>
<tr><td colspan="1" rowspan="1"><p><a href="https://developer.android.com/reference/android/support/v7/widget/LinearLayoutManager.html" target="_blank">LinearLayoutManager</a> muestra elementos en una lista de desplazamiento horizontal o vertical.</p>
<p><img style="max-width: 146.70px" src="img\4ddefc2975a500a8.png"></p>
</td><td colspan="1" rowspan="1"><p><a href="https://developer.android.com/reference/android/support/v7/widget/GridLayoutManager.html" target="_blank">GridLayoutManager</a> muestra elementos en una cuadrícula.</p>
<p><img style="max-width: 144.40px" src="img\fac440afb6f65950.png"></p>
</td><td colspan="1" rowspan="1"><p><a href="https://developer.android.com/reference/android/support/v7/widget/StaggeredGridLayoutManager.html" target="_blank">StaggeredGridLayoutManager</a> muestra elementos en una cuadrícula escalonada.</p>
<p><img style="max-width: 143.70px" src="img\2a44143f4e286c2e.png"></p>
</td></tr>
</table>
<p>Para esta práctica usaremos el LinearLayoutManager</p>
<p>Añade el elemento &lt;RecyclerView&gt; al layout activity_main.xml</p>
<pre><code>&lt;android.support.v7.widget.RecyclerView
   android:id=&#34;@+id/poem_list&#34;
   android:layout_width=&#34;match_parent&#34;
   android:layout_height=&#34;match_parent&#34;
   android:scrollbars=&#34;vertical&#34; /&gt;</code></pre>
<p>En el método onCreate() de la MainActivity, establece el LinearLayoutManager al RecyclerView</p>
<pre><code>@Override
protected void onCreate(Bundle savedInstanceState) {
   . . . .

   RecyclerView recyclerView = findViewById(R.id.poem_list);
   recyclerView.setLayoutManager(new LinearLayoutManager(this));
}</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Adapter" duration="0">
        <p>El adaptador es el encargado de transformar los elementos del ArrayList en Views para insertarlas en el RecyclerView.</p>
<p>Se crea una plantilla definiendo cómo tiene que ser una fila (item_poem.xml). El Adaptador creará diferentes Views a partir de la plantilla, y las rellenará con los datos de los elementos del ArrayList. </p>
<p><img style="max-width: 480.70px" src="img\16430b779b613c71.png"></p>
<p>La clave del RecyclerView es que no crea un View para cada elemento del ArrayList, sino que crea las suficientes para que se muestren en pantalla, y cuando el usuario hace scroll sobre la lista, reutiliza las que han quedado invisibles, rellenándolas con los datos de los nuevos elementos del ArrayList.</p>
<p><img style="max-width: 373.24px" src="img\e1204cf223775586.png"></p>
<p><strong>⏩Crea la plantilla para los items de la lista</strong></p>
<p>Crea un nuevo layout llamado item_poem.xml con el siguiente código:</p>
<pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;android.support.v7.widget.CardView xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;
   android:layout_width=&#34;match_parent&#34;
   android:layout_height=&#34;wrap_content&#34;
   android:layout_margin=&#34;4dp&#34;&gt;
   &lt;LinearLayout
       android:layout_width=&#34;match_parent&#34;
       android:layout_height=&#34;wrap_content&#34;
       android:orientation=&#34;vertical&#34;
       android:padding=&#34;8dp&#34;&gt;
       &lt;TextView
           android:id=&#34;@+id/poem_title&#34;
           android:layout_width=&#34;match_parent&#34;
           android:layout_height=&#34;wrap_content&#34;
           android:fontFamily=&#34;cursive&#34;
           android:textSize=&#34;26sp&#34;
           android:textStyle=&#34;bold&#34; /&gt;
       &lt;TextView
           android:id=&#34;@+id/poem_author&#34;
           android:layout_width=&#34;match_parent&#34;
           android:layout_height=&#34;wrap_content&#34;
           android:fontFamily=&#34;cursive&#34;
           android:textSize=&#34;20sp&#34; /&gt;
   &lt;/LinearLayout&gt;
&lt;/android.support.v7.widget.CardView&gt;</code></pre>
<p><strong>⏩Crea el Adaptador</strong></p>
<p>Crea una nueva clase llamada PoemsRecyclerAdapter con el siguiente código:</p>
<pre><code>public class PoemsRecyclerAdapter extends RecyclerView.Adapter&lt;PoemsRecyclerAdapter.PoemViewHolder&gt;{

   List&lt;Poem&gt; list;

   PoemsRecyclerAdapter(List&lt;Poem&gt; list){
       this.list = list;
   }

   @Override
   public PoemViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {
       View itemPoem = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_poem, parent, false);
       return new PoemViewHolder(itemPoem);
   }

   @Override
   public void onBindViewHolder(PoemViewHolder holder, int position) {
       Poem poem = list.get(position);

       holder.poemAuthor.setText(poem.author);
       holder.poemTitle.setText(poem.title);
   }

   @Override
   public int getItemCount() {
       return (list != null ? list.size() : 0);
   }

   class PoemViewHolder extends RecyclerView.ViewHolder {
       private TextView poemTitle;
       private TextView poemAuthor;

       PoemViewHolder(View itemPoem) {
           super(itemPoem);
           poemTitle = itemPoem.findViewById(R.id.poem_title);
           poemAuthor = itemPoem.findViewById(R.id.poem_author);
       }
   }
}</code></pre>
<p><strong>⏩Establece el Adaptador al RecyclerView</strong></p>
<p>En el método onCreate() de la MainActivity, añade el siguiente código:</p>
<pre><code>PoemsRecyclerAdapter poemsRecyclerAdapter = new PoemsRecyclerAdapter(poemList);
recyclerView.setAdapter(poemsRecyclerAdapter);</code></pre>
<aside class="warning"><p><strong>IMPORTANTE: Cuando se modifique el ArrayList, hay que notificar al adaptador, y este ordenará al RecyclerView actualizar la lista. Esto se hace con el siguiente método:</strong></p>
<p><strong><code>poemsRecyclerAdapter</code></strong><code>.notifyDataSetChanged();</code></p>
</aside>
<p>Tratemos de comprender el código del Adaptador:</p>
<ol type="1" start="1">
<li>En el constructor le pasamos el ArrayList que contendrá los poemas.</li>
<li>El método onCreateViewHolder() lo llamará el RecyclerView cuando necesite una nueva <code>View</code> para representar un ítem.<br>Para obtener una View en la que representar un Poema, inflamos el layout item_poem.xml<br>En lugar de retornarle al RecyclerView la View, le retornamos un objeto de la clase PoemViewHolder, que es la propia View pero con los receptáculos para los datos del poema guardados como varibles.</li>
<li>El método onBindViewHolder() lo llamará el RecyclerView para rellenar los datos de un ítem. El RecyclerView nos pasa el ViewHolder y la posición, y lo rellenamos con el elemento del <code>ArrayList</code> que está en esa posición. </li>
</ol>


      </google-codelab-step>
    
  </google-codelab>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49880327-14', 'auto');

    (function() {
      var gaCodelab = '';
      if (gaCodelab) {
        ga('create', gaCodelab, 'auto', {name: 'codelab'});
      }

      var gaView;
      var parts = location.search.substring(1).split('&');
      for (var i = 0; i < parts.length; i++) {
        var param = parts[i].split('=');
        if (param[0] === 'viewga') {
          gaView = param[1];
          break;
        }
      }
      if (gaView && gaView !== gaCodelab) {
        ga('create', gaView, 'auto', {name: 'view'});
      }
    })();
  </script>

</body>
</html>
