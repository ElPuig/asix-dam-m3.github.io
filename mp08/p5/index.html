
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>RecyclerView</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="mp08/p5"
                  title="RecyclerView"
                  environment="web"
                  feedback-link="https://github.com/gerardfp">
    
      <google-codelab-step label="Introducción" duration="0">
        <p>El objetivo de esta práctica es explicar el elemento <strong><code>RecyclerView</code></strong>.</p>
<p>El widget <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.html" target="_blank"><code>RecyclerView</code></a> nos permite mostrar una lista de elementos y hacer scroll en ellos.</p>
<p>Realizaremos una aplicación que mostrará una lista de Ítems. Cada Ítem tendrá un nombre, una descripción y un <em>rating</em>.</p>
<p>Al hacer click sobre un ítem de la lista, se abrirá una nueva activity donde se mostrará el detalle de ese item.</p>
<p>CODE: <a href="https://github.com/gerardfp/recyclerview" target="_blank">https://github.com/gerardfp/recyclerview</a></p>
<p class="image-container"><img style="width: 258.00px" src="img\c9cb7ade2599e3ba.gif"></p>
<p class="image-container"><img style="width: 557.00px" src="img\62b623b75ed4578d.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Crea el proyecto" duration="0">
        <p>Selecciona &#34;Empty Activity&#34; como plantilla para la actividad principal.</p>
<p>Añade las bibliotecas <code>RecyclerView</code> en el archivo <code>build.gradle (Module: app)</code></p>
<pre><code>dependencies {
   implementation &#39;androidx.recyclerview:recyclerview:1.0.0&#39;
}</code></pre>
<ol type="1" start="1">
<li>Crea el grafo de navegacion (<code>res/navigation/navigation.xml</code>):</li>
</ol>
<p class="image-container"><img style="width: 367.00px" src="img\fbb835e5a833970c.png"></p>
<aside class="warning"><p>Android Studio te pedirá añadir la dependencia , en caso de que no la tuvieras ya añadida</p>
<p class="image-container"><img style="width: 312.00px" src="img\d9d42ef6cc2006dd.png"></p>
<p><code>implementation </code><strong><code>&#39;androidx.navigation:navigation-fragment:2.0.0&#39;</code></strong></p>
<p><code>implementation </code><strong><code>&#39;androidx.navigation:navigation-ui:2.1.0&#39;</code></strong></p>
</aside>
<ol type="1" start="2">
<li>Añade la destinación <code>ItemListFragment</code>:<br><br><img style="width: 340.00px" src="img\308ee90af4381430.png"></li>
</ol>
<p class="image-container"><img style="width: 489.00px" src="img\684072e674c0dbc7.png"></p>
<p class="image-container"><img style="width: 372.00px" src="img\1d4ae73b6f38ecd2.png"><br></p>
<ol type="1" start="3">
<li>Añade el NavHost al layout de la MainActivity (<code>res/layout/activity_main.xml</code>):<br></li>
</ol>
<pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;
   xmlns:app=&#34;http://schemas.android.com/apk/res-auto&#34;
   xmlns:tools=&#34;http://schemas.android.com/tools&#34;
   android:layout_width=&#34;match_parent&#34;
   android:layout_height=&#34;match_parent&#34;
   tools:context=&#34;.MainActivity&#34;&gt;

   &lt;fragment
       android:id=&#34;@+id/nav_host_fragment&#34;
       android:name=&#34;androidx.navigation.fragment.NavHostFragment&#34;
       android:layout_width=&#34;match_parent&#34;
       android:layout_height=&#34;match_parent&#34;
       app:defaultNavHost=&#34;true&#34;
       app:layout_constraintLeft_toLeftOf=&#34;parent&#34;
       app:layout_constraintRight_toRightOf=&#34;parent&#34;
       app:layout_constraintTop_toTopOf=&#34;parent&#34;
       app:navGraph=&#34;@navigation/navigation&#34; /&gt;

&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Dataset" duration="0">
        <p>El Dataset es el conjunto de datos que queremos mostrar en el RecyclerView. Pueden ser datos descargados de la red, obtenidos de una base de datos, de un fichero JSON, generados mediante código, etc. etc. etc.</p>
<p>Para esta práctica utilizaremos como Dataset un <code>ArrayList</code>. Este ArrayList contendrá los elementos que hay que mostrar en el RecyclerView. Para esta práctica utilizamos un elemento genérico, llamado <code>Item</code>, pero en una aplicación real dependerá de la clase de objetos que se quieran mostrar (Contactos, Mensajes, Personajes, Películas, etc.)</p>
<p>Crea la clase <strong><code>Item</code></strong> y añade los campos siguientes:</p>
<pre><code>public class Item {
   public String name;
   public String desc;
   public float rating;
}</code></pre>
<p>Los variables de datos y la lógica de la aplicación van el ViewModel, por tanto, es ahí donde crearemos el ArrayList de Items.</p>
<ol type="1" start="1">
<li>Crea una nueva clase llamada <code>MainViewModel</code> y añade en ella el ArrayList. Pondremos un metodo en el constructor que añada los Items:</li>
</ol>
<pre><code>import android.app.Application;
import java.util.ArrayList;
import java.util.List;
import androidx.annotation.NonNull;
import androidx.lifecycle.AndroidViewModel;
import androidx.lifecycle.MutableLiveData;

public class MainViewModel extends AndroidViewModel {

   MutableLiveData&lt;List&lt;Item&gt;&gt; itemList = new MutableLiveData&lt;&gt;();

   public MainViewModel(@NonNull Application application) {
       super(application);
       cargarItems();
   }

   public void cargarItems(){
       List&lt;Item&gt; items = new ArrayList&lt;&gt;();
       for (int i = 0; i &lt; 200; i++) {
           Item item = new Item();
           item.name = &#34;Item &#34; + i;
           item.desc = &#34;Description &#34; + i;
           item.rating = (float) Math.random()*10;
           items.add(item);
       }
       itemList.setValue(items);
   }
}</code></pre>
<p class="image-container"><img style="width: 250.00px" src="img\c3baeea9edda4f2.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="ViewHolder" duration="0">
        <p>El ViewHolder és la <strong>plantilla </strong>de cómo se mostrarán los elementos en el RecyclerView. Es decir, cada elemento del RecyclerView será una copia de la plantilla con los campos rellenados con los elementos del Dataset.</p>
<p>Para crear el ViewHolder tenemos que crear:</p>
<ul>
<li>Un fichero con el Layout y</li>
<li>Una clase que haga el <code>findViewById()</code> de cada elemento del layout que tenga que ser rellenado con datos.</li>
</ul>
<h2 is-upgraded>Layout viewholder_item.xml</h2>
<p>Crea un nuevo fichero de layout llamado <code>res/layout/viewholder_item.xml</code></p>
<p class="image-container"><img style="width: 606.00px" src="img\7f3bbde9c5ea9b91.png"></p>
<p>Este layout será la plantilla para un elemento del RecyclerView. Añadiremos los componentes que necesitemos: </p>
<pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;LinearLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;
   android:orientation=&#34;vertical&#34;
   android:layout_width=&#34;match_parent&#34;
   android:layout_height=&#34;wrap_content&#34;
   android:padding=&#34;8dp&#34;&gt;

   &lt;TextView
       android:id=&#34;@+id/item_name&#34;
       android:layout_width=&#34;match_parent&#34;
       android:layout_height=&#34;wrap_content&#34;
       android:textSize=&#34;24sp&#34;
       android:textStyle=&#34;bold&#34; /&gt;

   &lt;TextView
       android:id=&#34;@+id/item_desc&#34;
       android:layout_width=&#34;match_parent&#34;
       android:layout_height=&#34;wrap_content&#34;/&gt;

   &lt;RatingBar
       android:id=&#34;@+id/item_rating&#34;
       android:numStars=&#34;5&#34;
       android:layout_width=&#34;wrap_content&#34;
       android:layout_height=&#34;wrap_content&#34;/&gt;

&lt;/LinearLayout&gt;</code></pre>
<p>En este caso hemos añadido un TextView para el nombre, otro para la descripción y un RatingBar.</p>
<p class="image-container"><img style="width: 723.00px" src="img\a3b7d75db84379de.png"></p>
<h2 is-upgraded>Classe ItemViewHolder</h2>
<p>Ahora hay que crear una clase que haga el <code>findViewById()</code> de cada elemento que haya que rellenar en la plantilla (con los datos de los Ítems del ArrayList). </p>
<p>En nuestra plantilla los elementos a rellenar son los dos TextView y el RatingBar.</p>
<pre><code>class ItemViewHolder extends RecyclerView.ViewHolder {
   TextView name, desc;
   RatingBar rating;

   ItemViewHolder(@NonNull View itemView) {
       super(itemView);
       name = itemView.findViewById(R.id.item_name);
       desc = itemView.findViewById(R.id.item_desc);
       rating = itemView.findViewById(R.id.item_rating);
   }
}</code></pre>
<p class="image-container"><img style="width: 736.40px" src="img\a829005f82a6efc4.gif"></p>
<aside class="special"><p>La clase <code>ViewHolder</code> la puedes crear en diversos sitios (Como clase interna de la clase MainActivity, en un fichero a parte, ...). Para este práctica lo más fácil es que la crees como clase interna de la MainActivity.</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Adapter" duration="0">
        <p>El adaptador es el encargado de crear las copias de la plantilla y rellenarlas con los datos.</p>
<p class="image-container"><img style="width: 705.07px" src="img\7efa555e1955a839.png"></p>
<p>Crea una nueva clase llamada <code>ItemsAdapter</code> con el siguiente código:</p>
<pre><code>class ItemsAdapter extends RecyclerView.Adapter&lt;ItemViewHolder&gt;{

   List&lt;Item&gt; items;

   @NonNull
   @Override
   public ItemViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
       return new ItemViewHolder(LayoutInflater.from(parent.getContext()).inflate(R.layout.viewholder_item, parent, false));
   }

   @Override
   public void onBindViewHolder(@NonNull ItemViewHolder holder, final int position) {

       final Item item = items.get(position);

       holder.name.setText(item.name);
       holder.desc.setText(item.desc);
       holder.rating.setRating(item.rating);

       holder.rating.setOnRatingBarChangeListener(new RatingBar.OnRatingBarChangeListener() {
           @Override
           public void onRatingChanged(RatingBar ratingBar, float v, boolean b) {
               item.rating = v;
           }
       });

       holder.itemView.setOnClickListener(new View.OnClickListener() {
           @Override
           public void onClick(View view) {
               mainViewModel.selectedItem.setValue(item);
               Navigation.findNavController(view).navigate(R.id.itemDetailFragment);
           }
       });
   }

   @Override
   public int getItemCount() {
       return items == null ? 0 : items.size();
   }

   public void setList(List&lt;Item&gt; items){
       this.items = items;
       notifyDataSetChanged();
   }
}</code></pre>
<p class="image-container"><img style="width: 736.40px" src="img\75d9cdcc28349064.gif"></p>
<p>El Adapter tiene 3 métodos:</p>
<ul>
<li><code>onCreateViewHolder()</code>: Este método es llamado por el RecyclerView cada vez que hay que <strong>crear </strong>una nueva copia de la plantilla para mostrar un nuevo elemento.</li>
</ul>
<p>Dentro de este método usamos el <code>LayoutInflater</code> para crear una copia de la plantilla <code>viewholder_item.xml</code>.<br>Se le pasa la copia de la plantilla a la clase <code>ItemViewHolder</code> para que haga los <code>findViewById()</code>.</p>
<ul>
<li><code>onBindViewHolder()</code>: Este método es llamado por el RecyclerView con el fin de <strong>rellenar </strong>una copia de la plantilla. La variable <code>holder</code> que nos pasa en el método es la copia de la plantilla que hay que rellenar, y la variable <code>position</code> es la posición que ocupa dentro del RecyclerView.</li>
</ul>
<p>En primer lugar obtenemos el <code>Item</code> del ArrayList que ocupa la posición que nos ha pasado el RecyclerView (es decir, la posicion del ViewHolder que hay que rellenar).</p>
<p>A continuación rellenamos los TextView y el RatingBar del <code>ViewHolder</code> con los datos del <code>Item</code> que hemos sacado del ArrayList.</p>
<p>Luego, establecemos el listener para el RatingBar de ese ViewHolder, que actualizará el rating del Item.</p>
<p>Por último, establecemos un listener al ViewHolder para que cuando se haga click en él, abra una nueva activity (<code>DetailActivity</code>) en la que se mostrará el detalle de ese Ítem. A la <code>DetailActivity</code> le pasamos la posición dentro del array del Ítem en el que se ha hecho click. La <code>DetailActivity</code> lo que tiene que hacer és sacar la posición del intent, acceder al Item que está en esa posición del ArrayList, y mostrar la información de ese Item: <a href="https://github.com/gerardfp/P5/blob/master/app/src/main/java/com/company/p5/DetailActivity.java" target="_blank">https://github.com/gerardfp/P5/blob/master/app/src/main/java/com/company/p5/DetailActivity.java</a></p>
<aside class="special"><p>La variable <code>itemView</code> de la clase ViewHolder hace referencia a todo el ítem en sí.</p>
</aside>
<ul>
<li><code>getItemCount()</code>: Este método es llamado por el RecyclerView con el fin de saber cuántos elementos se tienen que mostrar. En nuestro caso retornamos el <code>size()</code> del ArrayList.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="RecyclerView" duration="0">
        <p><a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.html" target="_blank"><code>RecyclerView</code></a> proporciona estos 3 administradores de layout:</p>
<table>
<tr><td colspan="1" rowspan="1"><p><a href="https://developer.android.com/reference/android/support/v7/widget/LinearLayoutManager.html" target="_blank">LinearLayoutManager</a><code> </code>muestra elementos en una lista de desplazamiento horizontal o vertical.</p>
<p class="image-container"><img style="width: 146.70px" src="img\4ddefc2975a500a8.png"></p>
</td><td colspan="1" rowspan="1"><p><a href="https://developer.android.com/reference/android/support/v7/widget/GridLayoutManager.html" target="_blank">GridLayoutManager</a><code> </code>muestra elementos en una cuadrícula.</p>
<p class="image-container"><img style="width: 144.40px" src="img\fac440afb6f65950.png"></p>
</td><td colspan="1" rowspan="1"><p><a href="https://developer.android.com/reference/android/support/v7/widget/StaggeredGridLayoutManager.html" target="_blank">StaggeredGridLayoutManager</a><code> </code>muestra elementos en una cuadrícula escalonada.</p>
<p class="image-container"><img style="width: 143.70px" src="img\2a44143f4e286c2e.png"></p>
</td></tr>
</table>
<p>Para esta práctica usaremos el <code>LinearLayoutManager</code></p>
<p>Añade el elemento <code>&lt;RecyclerView&gt;</code> al layout <code>activity_main.xml</code></p>
<pre><code>&lt;androidx.recyclerview.widget.RecyclerView
   android:id=&#34;@+id/item_list&#34;
   android:layout_width=&#34;match_parent&#34;
   android:layout_height=&#34;wrap_content&#34;
   app:layoutManager=&#34;androidx.recyclerview.widget.LinearLayoutManager&#34; /&gt;</code></pre>
<p>En el método <code>onViewCreated()</code> del <code>ItemListFragment</code> haremos lo siguiente:</p>
<ol type="1" start="1">
<li>Recuperar el RecyclerView del XML con <code>findViewById()</code></li>
<li>Establecerle el adaptador <code>ItemsAdapter</code> (<em>el encargado de rellenar el RecyclerView</em>)</li>
</ol>
<pre><code>public class ItemListFragment extends Fragment {

   MainViewModel mainViewModel;
   ItemsAdapter itemsAdapter;

   // ...   

   @Override
   public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
       super.onViewCreated(view, savedInstanceState);

       mainViewModel = ViewModelProviders.of(requireActivity()).get(MainViewModel.class);

       RecyclerView recyclerView = view.findViewById(R.id.item_list);
       recyclerView.setAdapter(itemsAdapter = new ItemsAdapter());

       mainViewModel.itemList.observe(getViewLifecycleOwner(), new Observer&lt;List&lt;Item&gt;&gt;() {
           @Override
           public void onChanged(List&lt;Item&gt; items) {
               itemsAdapter.setList(items);
           }
       });
   }

   // ...
}</code></pre>
<p>NOTA: Para mostrar un separador entre cada elemento del RecyclerView podemos usar la clase <code>DividerItemDecoration</code>:</p>
<pre><code>RecyclerView recyclerView = view.findViewById(R.id.item_list);

recyclerView.addItemDecoration(new DividerItemDecoration(recyclerView.getContext(), DividerItemDecoration.VERTICAL));

recyclerView.setAdapter(new ItemsAdapter());</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="ItemDetailFragment" duration="0">
        <p>Añade una nueva destinación llamada <code>ItemDetailFragment</code>.</p>
<p><code>ItemDetailFragment.java</code></p>
<pre><code>import android.os.Bundle;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import androidx.lifecycle.Observer;
import androidx.lifecycle.ViewModelProviders;

import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.RatingBar;
import android.widget.TextView;

public class ItemDetailFragment extends Fragment {

   public ItemDetailFragment() { }

   @Override
   public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
       return inflater.inflate(R.layout.fragment_item_detail, container, false);
   }

   @Override
   public void onViewCreated(@NonNull final View view, @Nullable Bundle savedInstanceState) {
       super.onViewCreated(view, savedInstanceState);

       MainViewModel mainViewModel = ViewModelProviders.of(requireActivity()).get(MainViewModel.class);

       mainViewModel.selectedItem.observe(getViewLifecycleOwner(), new Observer&lt;Item&gt;() {
           @Override
           public void onChanged(final Item item) {
               if(item == null) return;

               TextView textViewName = view.findViewById(R.id.name);
               TextView textViewDesc = view.findViewById(R.id.desc);
               RatingBar ratingBar = view.findViewById(R.id.rating);

               textViewName.setText(item.name);
               textViewDesc.setText(item.desc);
               ratingBar.setRating(item.rating);

               ratingBar.setOnRatingBarChangeListener(new RatingBar.OnRatingBarChangeListener() {
                   @Override
                   public void onRatingChanged(RatingBar ratingBar, float v, boolean b) {
                       item.rating = v;
                   }
               });
           }
       });
   }
}</code></pre>
<p><code>fragment_item_detail.xml</code></p>
<pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;FrameLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;
   xmlns:tools=&#34;http://schemas.android.com/tools&#34;
   android:layout_width=&#34;match_parent&#34;
   android:layout_height=&#34;match_parent&#34;
   tools:context=&#34;.ItemDetailFragment&#34;&gt;

   &lt;LinearLayout
       android:layout_width=&#34;match_parent&#34;
       android:layout_height=&#34;wrap_content&#34;
       android:orientation=&#34;vertical&#34;&gt;

       &lt;TextView
           android:id=&#34;@+id/name&#34;
           android:gravity=&#34;center&#34;
           android:textSize=&#34;48sp&#34;
           android:textStyle=&#34;bold&#34;
           android:layout_width=&#34;match_parent&#34;
           android:layout_height=&#34;wrap_content&#34; /&gt;

       &lt;RatingBar
           android:id=&#34;@+id/rating&#34;
           android:layout_width=&#34;wrap_content&#34;
           android:layout_height=&#34;wrap_content&#34; /&gt;

       &lt;TextView
           android:id=&#34;@+id/desc&#34;
           android:textSize=&#34;24sp&#34;
           android:layout_width=&#34;match_parent&#34;
           android:layout_height=&#34;wrap_content&#34; /&gt;

   &lt;/LinearLayout&gt;

&lt;/FrameLayout&gt;</code></pre>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
